# Navi Cloud - Dispatch Worker (Routes requests to user apps)
name = "navi-cloud-dispatch"
main = "src/dispatch.ts"
compatibility_date = "2024-12-01"

# Routes all *.usenavi.app traffic
routes = [
  { pattern = "*.usenavi.app", zone_name = "usenavi.app" }
]

[vars]
ENVIRONMENT = "production"

# D1 Database for app registry
[[d1_databases]]
binding = "REGISTRY_DB"
database_name = "navi-cloud-registry"
database_id = "" # Fill after: wrangler d1 create navi-cloud-registry

# Dispatch namespace for user Workers
[[dispatch_namespaces]]
binding = "USER_WORKERS"
namespace = "navi-user-apps"

# Secrets (set via `wrangler secret put`):
# - DEPLOY_SECRET (auth for deploy API)
